<% if !marketplace.ready_for_shopping? && policy(marketplace).edit? %>
  <%= render AlertComponent.new(scheme: :warning, icon: :exclamation_triangle, title: t('marketplace.marketplace.config_missing_title')) do %>
    <%= t('marketplace.marketplace.config_missing_explainer_html',
          edit_link: link_to(t('marketplace.marketplace.edit'), marketplace.location(:edit)) ) %>
  <% end %>
<% end %>

<%- if marketplace.ready_for_shopping? || policy(marketplace).edit? %>
  <%- shopper = if current_person.is_a?(Guest)
      Marketplace::Shopper.find_or_create_by(id: session[:guest_shopper_id] ||= SecureRandom.uuid)
    else
      Marketplace::Shopper.find_or_create_by(person: current_person)
  end %>

  <%- cart = marketplace.carts.create_with(contact_email: shopper.person&.email).find_or_create_by(shopper: shopper, status: :pre_checkout) %>

  <%= render cart %>
<%- end %>

<div class="my-2 text-right">
  <%- if policy(marketplace).edit? %>
    <%= render ButtonComponent.new(scheme: :secondary,
      label: t('marketplace.marketplace.edit'), href: marketplace.location(:edit), method: :get) %>
  <%- end %>
</div>
