#!/bin/bash

function install_package {
  echo "Attempting to install $1"
  output=$(command -v brew)
  if [ -n $output ]; then
    echo "Installing $1 via homebrew"
    brew install $1
    return
  fi

  echo "We're not sure how to automatically install $1 on your machine"
  echo "If you want help, reach out via chat or github!"
}

function setup_package {
  command_output=$(command -v $1)
  brew_output=$(brew ls --versions $1)
  if [ -z $command_output ]; then
    echo "$1 command not detected, checking brew"
    if [ -n $brew_output ]; then
      echo "$1 not found, installing through Homebrew"
      install_package $1
    else
      echo "$1 installed, continuing..."
    fi
  else
    echo "$1 installed, continuing..."
  fi
}

setup_package "overmind"
setup_package "yarn"
setup_package "shared-mime-info"

if test -f ".env"; then
  echo "Found .env, leaving it in place!"
else
  echo "Copying .env.example to .env"
  cp .env.example .env
fi

# Installs environment dependencies such as packages and
# prepares the application by running setup scripts in
# each module
yarn install
yarn global add maildev
(cd convene-web && bin/setup)
